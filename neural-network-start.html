<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Advanced Automation - Neural Network</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- p5 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.9.0/p5.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.9.0/addons/p5.dom.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.9.0/addons/p5.sound.min.js"></script>

    <!-- ml5 -->
    <script src="https://unpkg.com/ml5@0.4.3/dist/ml5.min.js"></script>

  </head>

  <body>
    <script>

/* Use this code to start going through the tutorial at https://youtu.be/8HEgeAbYphA beginning at 9:00.

*/
let model;
let targetLabel = 'C';
let state = 'collection'
// let trainingData = [];

function setup() {
        createCanvas(400, 400);

let options = {
  inputs: ['x' , 'y'],
  outputs: ['label'],
  task: 'classification',
  debug: 'true'
};
model = ml5.neuralNetwork(options);
        background(230);
}

function keyPressed(){
  if (key == 't'){
    state = 'training',
    console.log('starting training.');
    model.normalizeData();
    let options = {
      epochs: 200
    }
    model.train(options, whileTraining, finishedTraining);
  } else {
      targetLabel = key.toUpperCase();
  }
}

function whileTraining(epoch, loss){
  console.log(epoch);
}

function finishedTraining(){
  console.log('finished training.');
  state = 'prediction'
}

function mousePressed(){

  let inputs = {
    x: mouseX,
    y: mouseY
  }

  if (state == 'collection'){
    let target = {
      label: targetLabel
  }
    model.addData(inputs,target);

stroke (0);
noFill();
ellipse(mouseX, mouseY, 24);
fill(0);
noStroke();
textAlign(CENTER,CENTER);
text(targetLabel, mouseX, mouseY);
} else if(state == 'prediction'){
  console.log(model.classify(inputs))
}

}

function gotResults(error, results){
  if (error){
    console.error(error);
    return;
  }
  console.log(results);
  stroke (0);
  noFill(0,0,255, 100);
  ellipse(mouseX, mouseY, 24);
  fill(0);
  noStroke();
  textAlign(CENTER,CENTER);
  text(results[0].label, mouseX, mouseY);
}

    </script>
  </body>
</html>
